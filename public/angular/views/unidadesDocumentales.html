<div layout="row" layout-align="center start">
	<div flex="90">
		<md-grid-list md-cols="4" md-cols-xs="1" md-cols-sm="2" md-cols-md="4" md-row-height="1:1" md-gutter="1em">
			<md-grid-tile ng-repeat="unidad in unidadesDocumentales" ng-click="showTabDialog($event, unidad._id)" style="background: #b7b7b7">
				<picture style="height: 100%"> <!-- Para que "layout-fill" en "img" funcione, requiere que sus contenedores tengan definido "height" -->
					<source media="(min-width: 1280px)" ng-srcset="files/imagenes/resize/{{unidad.identificacion.codigoReferencia}}_sm.jpg">
					<img ng-if="unidad.adicional.imagen" ng-src="files/imagenes/resize/{{unidad.identificacion.codigoReferencia}}_xs.jpg" layout-fill>
				</picture>
				<md-grid-tile-footer style="background: rgba(0,0,0,0.5);">
					<div style="position: absolute; left: 0; right: 1em; top: 1em; bottom: 0; overflow: auto;">
						<h3 md-truncate>{{unidad.identificacion.codigoReferencia}}</h3>
					</div>
				</md-grid-tile-footer>
			</md-grid-tile>
		</md-grid-list>
		<section layout="row" layout-align="end center" layout-wrap>
			<md-button class="md-raised md-primary" ng-show="user && user.permisos.create" ng-click="crearUnidad()">Agregar unidad</md-button>
		</section>
	</div>
</div>

<!-- <br>
<pre>{{unidadesDocumentales | json}}</pre> -->

<script type="text/ng-template" id="tabDialog.tmpl.html">
	<md-dialog aria-label="Unidad documental"> <!-- flex="75" For sizing-->
		<form>
			<md-toolbar>
				<div class="md-toolbar-tools">
					<h2>{{unidad.identificacion.codigoReferencia}}</h2>
					<span flex></span>
					<md-button class="md-icon-button" ng-click="cancel()">
						<i class="material-icons" aria-label="Cerrar">close</i>
					</md-button>
				</div>
			</md-toolbar>
			<md-dialog-content style="max-width:800px;max-height:810px;">
				<md-tabs md-dynamic-height md-border-bottom md-swipe-content class="md-accent md-hue-2">
					<md-tab label="Identificación">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr>
											<td>Código de referencia</td>
											<td>{{unidad.identificacion.codigoReferencia}}</td>
										</tr>
										<tr ng-if="unidad.identificacion.referenciaProcedencia">
											<td>Referencia de procedencia</td>
											<td>{{unidad.identificacion.referenciaProcedencia}}</td>
										</tr>
										<tr ng-if="unidad.identificacion.titulo && unidad.identificacion.titulo.archivoProcedencia">
											<td>Título generado por el archivo de procedencia</td>
											<td>{{unidad.identificacion.titulo.archivoProcedencia}}</td>
										</tr>
										<tr ng-if="unidad.identificacion.titulo && unidad.identificacion.titulo.inscrito">
											<td>Título inscrito</td>
											<td>{{unidad.identificacion.titulo.inscrito}}</td>
										</tr>
										<tr ng-if="unidad.identificacion.titulo && unidad.identificacion.titulo.otroObjeto">
											<td>Título a partir de otro objeto</td>
											<td>{{unidad.identificacion.titulo.otroObjeto}}</td>
										</tr>
										<tr ng-if="unidad.identificacion.fecha">
											<td>Fecha</td>
											<td>{{unidad.identificacion.fecha | date:'yyyy'}}</td>
										</tr>
										<tr ng-if="unidad.identificacion.autores && unidad.identificacion.autores.length > 0">
											<td>Autores</td>
											<td>
												<table>
													<tr ng-repeat="autor in unidad.identificacion.autores">
														<td>{{autor.tipo}}</td>
														<td>{{autor.nombre}}</td>
													</tr>
												</table>
											</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Estructura y contenido" ng-if="unidad.estructuraContenido.estructuraFormal || (unidad.estructuraContenido.encuadre && (unidad.estructuraContenido.encuadre.orientacion || unidad.estructuraContenido.encuadre.plano || unidad.estructuraContenido.encuadre.anguloCamara || unidad.estructuraContenido.encuadre.nivelCamara || unidad.estructuraContenido.encuadre.tipoCamara || unidad.estructuraContenido.encuadre.edicionImagen)) || unidad.estructuraContenido.descripcion || unidad.estructuraContenido.tomadaDesde || unidad.estructuraContenido.tomadaHacia || unidad.estructuraContenido.lugarDescrito">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="unidad.estructuraContenido.estructuraFormal">
											<td>Estructura formal</td>
											<td>{{unidad.estructuraContenido.estructuraFormal}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.encuadre.orientacion">
											<td>Orientación</td>
											<td>{{unidad.estructuraContenido.encuadre.orientacion}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.encuadre.plano">
											<td>Plano</td>
											<td>{{unidad.estructuraContenido.encuadre.plano}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.encuadre.anguloCamara">
											<td>Ángulo de la cámara</td>
											<td>{{unidad.estructuraContenido.encuadre.anguloCamara}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.encuadre.nivelCamara">
											<td>Nivel de la cámara</td>
											<td>{{unidad.estructuraContenido.encuadre.nivelCamara}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.encuadre.tipoCamara">
											<td>Tipo de cámara</td>
											<td>{{unidad.estructuraContenido.encuadre.tipoCamara}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.encuadre.edicionImagen">
											<td>Edición de la imagen</td>
											<td>{{unidad.estructuraContenido.encuadre.edicionImagen}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.descripcion">
											<td>Descripción</td>
											<td>{{unidad.estructuraContenido.descripcion}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.tomadaDesde">
											<td>Tomada desde</td>
											<td>{{unidad.estructuraContenido.tomadaDesde}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.tomadaHacia">
											<td>Tomada hacia</td>
											<td>{{unidad.estructuraContenido.tomadaHacia}}</td>
										</tr>
										<tr ng-if="unidad.estructuraContenido.lugarDescrito">
											<td>Lugar descrito</td>
											<td>
												{{unidad.estructuraContenido.lugarDescrito.formattedAddress}}
												<br>
												<ng-map center="{{[unidad.estructuraContenido.lugarDescrito.location.lat, unidad.estructuraContenido.lugarDescrito.location.lng]}}" zoom="15">
													<marker position="{{[unidad.estructuraContenido.lugarDescrito.location.lat, unidad.estructuraContenido.lugarDescrito.location.lng]}}"></marker>
												</ng-map>
											</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Características físicas" ng-if="unidad.caracteristicasFisicas.tipo || (unidad.caracteristicasFisicas.soportePrimario.materiales || unidad.caracteristicasFisicas.soportePrimario.dimension || (unidad.caracteristicasFisicas.soportePrimario.inscripciones && unidad.caracteristicasFisicas.soportePrimario.inscripciones.length > 0)) || (unidad.caracteristicasFisicas.soporteSecundario.materiales || unidad.caracteristicasFisicas.soporteSecundario.dimension || (unidad.caracteristicasFisicas.soporteSecundario.inscripciones && unidad.caracteristicasFisicas.soporteSecundario.inscripciones.length > 0)) || (unidad.caracteristicasFisicas.sellos && unidad.caracteristicasFisicas.sellos.length > 0)">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="unidad.caracteristicasFisicas.tipo">
											<td>Tipo</td>
											<td>{{unidad.caracteristicasFisicas.tipo}}</td>
										</tr>
										<tr ng-if="unidad.caracteristicasFisicas.soportePrimario.materiales || unidad.caracteristicasFisicas.soportePrimario.dimension || (unidad.caracteristicasFisicas.soportePrimario.inscripciones && unidad.caracteristicasFisicas.soportePrimario.inscripciones.length > 0)">
											<td>Soporte primario</td>
											<td>
												<table class="my-table-md-dialog">
													<tr ng-if="unidad.caracteristicasFisicas.soportePrimario.materiales">
														<td>Materiales</td>
														<td>{{unidad.caracteristicasFisicas.soportePrimario.materiales}}</td>
													</tr>
													<tr ng-if="unidad.caracteristicasFisicas.soportePrimario.dimension">
														<td>Dimension</td>
														<td>{{unidad.caracteristicasFisicas.soportePrimario.dimension.ancho}} x {{unidad.caracteristicasFisicas.soportePrimario.dimension.alto}} {{unidad.caracteristicasFisicas.soportePrimario.dimension.unidad}}</td>
													</tr>
													<tr ng-if="unidad.caracteristicasFisicas.soportePrimario.inscripciones && unidad.caracteristicasFisicas.soportePrimario.inscripciones.length > 0">
														<td>Inscripcion</td>
														<td>
															<table>
																<tr ng-repeat="inscripcion in unidad.caracteristicasFisicas.soportePrimario.inscripciones">
																	<td>{{inscripcion.transcripcion}}<span ng-if="inscripcion.ubicacion"> ({{inscripcion.ubicacion}})</span></td>
																</tr>
															</table>
														</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.caracteristicasFisicas.soporteSecundario.materiales || unidad.caracteristicasFisicas.soporteSecundario.dimension || (unidad.caracteristicasFisicas.soporteSecundario.inscripciones && unidad.caracteristicasFisicas.soporteSecundario.inscripciones.length > 0)">
											<td>Soporte secundario</td>
											<td>
												<table class="my-table-md-dialog">
													<tr ng-if="unidad.caracteristicasFisicas.soporteSecundario.materiales">
														<td>Materiales</td>
														<td>{{unidad.caracteristicasFisicas.soporteSecundario.materiales}}</td>
													</tr>
													<tr ng-if="unidad.caracteristicasFisicas.soporteSecundario.dimension">
														<td>Dimension</td>
														<td>{{unidad.caracteristicasFisicas.soporteSecundario.dimension.ancho}} x {{unidad.caracteristicasFisicas.soporteSecundario.dimension.alto}} {{unidad.caracteristicasFisicas.soporteSecundario.dimension.unidad}}</td>
													</tr>
													<tr ng-if="unidad.caracteristicasFisicas.soporteSecundario.inscripciones && unidad.caracteristicasFisicas.soporteSecundario.inscripciones.length > 0">
														<td>Inscripcion</td>
														<td>
															<table>
																<tr ng-repeat="inscripcion in unidad.caracteristicasFisicas.soporteSecundario.inscripciones">
																	<td>{{inscripcion.transcripcion}}<span ng-if="inscripcion.ubicacion"> ({{inscripcion.ubicacion}})</span></td>
																</tr>
															</table>
														</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.caracteristicasFisicas.sellos && unidad.caracteristicasFisicas.sellos.length > 0">
											<td>Sellos</td>
											<td>
												<table>
													<tr ng-repeat="sellos in unidad.caracteristicasFisicas.sellos">
														<td>{{sellos.transcripcion}} <span ng-if="sellos.ubicacion">({{sellos.ubicacion}})</span></td>
													</tr>
												</table>
											</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Documentación asociada" ng-if="(unidad.documentacionAsociada.fotografiaMismoNegativo && unidad.documentacionAsociada.fotografiaMismoNegativo.length > 0) || (unidad.documentacionAsociada.fotografiaBase && unidad.documentacionAsociada.fotografiaBase.length > 0) || (unidad.documentacionAsociada.reprografia && unidad.documentacionAsociada.reprografia.length > 0) || (unidad.documentacionAsociada.fotografiaMismaSecuencia && unidad.documentacionAsociada.fotografiaMismaSecuencia.length > 0) || (unidad.documentacionAsociada.fotografiaConsecutiva && unidad.documentacionAsociada.fotografiaConsecutiva.length > 0) || (unidad.documentacionAsociada.fotografiaConsecutivaOtraCamara && unidad.documentacionAsociada.fotografiaConsecutivaOtraCamara.length > 0) || (unidad.documentacionAsociada.fotografiaEncuadreSimilar && unidad.documentacionAsociada.fotografiaEncuadreSimilar.length > 0) || (unidad.documentacionAsociada.grabadoRelacionado && unidad.documentacionAsociada.grabadoRelacionado.length > 0)">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="unidad.documentacionAsociada.fotografiaMismoNegativo && unidad.documentacionAsociada.fotografiaMismoNegativo.length > 0">
											<td>Fotografía a partir del mismo negativo</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.fotografiaMismoNegativo">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.fotografiaBase && unidad.documentacionAsociada.fotografiaBase.length > 0">
											<td>Fotografía base</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.fotografiaBase">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.reprografia && unidad.documentacionAsociada.reprografia.length > 0">
											<td>Reprografía</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.reprografia">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.fotografiaMismaSecuencia && unidad.documentacionAsociada.fotografiaMismaSecuencia.length > 0">
											<td>Fotografía de la misma secuencia</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.fotografiaMismaSecuencia">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.fotografiaConsecutiva && unidad.documentacionAsociada.fotografiaConsecutiva.length > 0">
											<td>Fotografía consecutiva</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.fotografiaConsecutiva">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.fotografiaConsecutivaOtraCamara && unidad.documentacionAsociada.fotografiaConsecutivaOtraCamara.length > 0">
											<td>Fotografía consecutiva con otra cámara</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.fotografiaConsecutivaOtraCamara">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.fotografiaEncuadreSimilar && unidad.documentacionAsociada.fotografiaEncuadreSimilar.length > 0">
											<td>Fotografía con encuadre similar</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.fotografiaEncuadreSimilar">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.documentacionAsociada.grabadoRelacionado && unidad.documentacionAsociada.grabadoRelacionado.length > 0">
											<td>Grabado relacionado</td>
											<td>
												<table>
													<tr ng-repeat="fotografia in unidad.documentacionAsociada.grabadoRelacionado">
														<td>{{fotografia}}</td>
													</tr>
												</table>
											</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Publicaciones" ng-if="(unidad.publicaciones.publicacion && unidad.publicaciones.publicacion.length > 0) || (unidad.publicaciones.exposicion && unidad.publicaciones.exposicion.length > 0)">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="unidad.publicaciones.publicacion && unidad.publicaciones.publicacion.length > 0">
											<td>Publicación</td>
											<td>
												<table>
													<tr ng-repeat="publicacion in unidad.publicaciones.publicacion">
														<td>{{publicacion}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="unidad.publicaciones.exposicion && unidad.publicaciones.exposicion.length > 0">
											<td>Exposición</td>
											<td>
												<table>
													<tr ng-repeat="exposicion in unidad.publicaciones.exposicion">
														<td>{{exposicion}}</td>
													</tr>
												</table>
											</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Notas" ng-if="unidad.notas.notas">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="unidad.notas.notas">
											<td>Notas</td>
											<td>{{unidad.notas.notas}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Control de la descripción" ng-if="(unidad.controlDescripcion.documentalistas && unidad.controlDescripcion.documentalistas.length > 0) || unidad.createdAt || unidad.updatedAt">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="unidad.controlDescripcion.documentalistas && unidad.controlDescripcion.documentalistas.length > 0">
											<td>Documentalistas</td>
											<td>
												<span ng-repeat="documentalista in unidad.controlDescripcion.documentalistas">{{documentalista.fullname}}<span ng-show="!$last">, </span></span>
											</td>
										</tr>
										<tr ng-if="unidad.createdAt">
											<td>Fecha de creación</td>
											<td>{{unidad.createdAt | date:'dd/MM/y HH:mm'}}</td>
										</tr>
										<tr ng-if="unidad.updatedAt">
											<td>Fecha de última actualización</td>
											<td>{{unidad.updatedAt | date:'dd/MM/y HH:mm'}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Imagen" ng-if="unidad.adicional.imagen">
						<md-content class="md-padding">
							<picture style="height: 100%">
								<source media="(min-width: 1920px)" ng-srcset="files/imagenes/resize/{{unidad.identificacion.codigoReferencia}}_lg.jpg">
								<source media="(min-width: 1280px)" ng-srcset="files/imagenes/resize/{{unidad.identificacion.codigoReferencia}}_md.jpg">
								<source media="(min-width: 960px)" ng-srcset="files/imagenes/resize/{{unidad.identificacion.codigoReferencia}}_sm.jpg">
								<img ng-src="files/imagenes/resize/{{unidad.identificacion.codigoReferencia}}_xs.jpg" layout-fill>
							</picture>
							<small class="md-caption">NOTA: La imagen actual es una versión comprimida. <md-button ng-href="/files/imagenes/{{unidad.adicional.imagen}}" target="_self">Ver original</md-button></small>
						</md-content>
					</md-tab>
				</md-tabs>
			</md-dialog-content>

			<md-dialog-actions layout="row" ng-if="user">
				<md-button class="md-icon-button" aria-label="Editar" ng-show="user && user.permisos.update" ng-click="editarUnidad()">
					<i class="material-icons">edit</i>
				</md-button>
				<md-button class="md-icon-button md-warn" aria-label="Borrar" ng-show="user && user.permisos.delete" ng-click="borrarUnidad()">
					<i class="material-icons">delete</i>
				</md-button>
				<span flex></span>
				<!-- <md-button ng-click="hide()" md-autofocus>
					Cerrar
				</md-button> -->
			</md-dialog-actions>
		</form>
	</md-dialog>
</script>
