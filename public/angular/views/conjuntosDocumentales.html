<div layout="row" layout-align="center start">
	<div flex="90">

		<nav class="crumbs" ng-if="breadcrumb.length != 0">
			<ol>
				<li class="crumb"><md-button ng-href="/conjunto?c=">{{nombreColeccion}}</md-button></li>
				<li ng-repeat="conjunto in breadcrumb" class="crumb" ng-if="!$last"><md-button ng-href="/conjunto?c={{conjunto.numeracion}}" target="_self">{{conjunto.identificacion.titulo}}</md-button></li>
				<li class="crumb"><md-button ng-disabled="true">{{breadcrumb[breadcrumb.length-1].identificacion.titulo}}</md-button></li>
			</ol>
		</nav>


		<md-grid-list md-cols="4" md-cols-xs="1" md-cols-sm="2" md-cols-md="4" md-row-height="1:1" md-gutter="1em">
			<md-grid-tile ng-repeat="conjunto in conjuntosDocumentales" ng-click="showTabDialog($event, conjunto._id)" style="background: rgba(183, 183, 183, 0); cursor: pointer;">
				<picture style="height: 100%">
					<source media="(min-width: 1280px)" ng-srcset="files/imagenes/resize/{{conjunto.adicional.imagen}}_sm.jpg">
					<img ng-if="conjunto.adicional.imagen" ng-src="{{'files/imagenes/resize/' + conjunto.adicional.imagen + '_xs.jpg'}}" style="object-fit: contain; height: 100%; width: 100%">
				</picture>
				<md-grid-tile-footer style="background: rgba(0,0,0,0.5); height: 64px;">
					<div style="position: absolute; left: 0; right: 1em; top: 1em; bottom: 0; overflow: auto;">
						<h3 md-truncate>{{conjunto.identificacion.titulo}}</h3>
					</div>
					<div layout="row" layout-align="space-between start" style="position: absolute; left: 0; right: 1em; top: 2em; bottom: 0; overflow: auto;">
						<div flex="50"><h3 md-truncate>{{conjunto.identificacion.codigoReferencia}}</h3></div>
						<div flex ng-if="conjunto.identificacion.fecha"><h3 md-truncate>{{conjunto.identificacion.fecha.inicio | date:'yyyy'}} <span ng-if="conjunto.identificacion.fecha.fin">- {{conjunto.identificacion.fecha.fin | date:'yyyy'}}</span></h3></div>
					</div>
				</md-grid-tile-footer>
				<i class="material-icons" style="position: absolute; top: 0; right: 0; font-size: 2.5em;">collections</i>
			</md-grid-tile>
		</md-grid-list>

		<section layout="row" layout-align="end center" layout-wrap>
			<md-button class="md-raised md-primary" ng-if="!isLeaf" ng-show="user && user.permisos.create" ng-click="crearConjunto()">Agregar conjunto</md-button>
			<md-button class="md-raised md-primary" ng-if="isLeaf || !isEmpty" ng-show="user && user.permisos.create" ng-click="crearUnidad()">Agregar unidad</md-button>
		</section>
	</div>
</div>

<!-- <br>
<pre>{{conjuntosDocumentales | json}}</pre> -->

<script type="text/ng-template" id="tabDialog.tmpl.html">
	<md-dialog aria-label="Conjunto documental" flex-xs="100" flex-sm="80" flex-gt-sm="75">
		<form>
			<md-toolbar>
				<div class="md-toolbar-tools">
					<h2>{{conjunto.identificacion.titulo}}</h2>
					<span flex></span>
					<md-button class="md-icon-button" ng-click="cancel()">
						<i class="material-icons" aria-label="Cerrar">close</i>
					</md-button>
				</div>
			</md-toolbar>
			<md-dialog-content>
				<md-tabs md-dynamic-height md-border-bottom md-swipe-content class="md-accent md-hue-3">
					<md-tab label="Presentación" ng-if="conjunto.adicional.presentacion">
						<md-content class="md-padding">
							<div ng-bind-html="conjunto.adicional.presentacion"></div>
						</md-content>
					</md-tab>
					<md-tab label="Identificación">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr>
											<td>Código de referencia</td>
											<td>{{conjunto.identificacion.codigoReferencia}}</td>
										</tr>
										<tr ng-if="conjunto.identificacion.institucion">
											<td>Institución</td>
											<td>{{conjunto.identificacion.institucion}}</td>
										</tr>
										<tr>
											<td>Título</td>
											<td>{{conjunto.identificacion.titulo}}</td>
										</tr>
										<tr ng-if="conjunto.identificacion.fecha && conjunto.identificacion.fecha.inicio">
											<td>Fecha</td>
											<td>
												{{conjunto.identificacion.fecha.inicio | date:'yyyy'}}
												<span ng-if="conjunto.identificacion.fecha.fin">&ndash; {{conjunto.identificacion.fecha.fin | date:'yyyy'}}</span>
												<span ng-if="conjunto.identificacion.fecha.aproximada"><small>(incluye fechas aproximadas)</small></span>
											</td>
										</tr>
										<tr ng-if="conjunto.identificacion.productor">
											<td>Productor</td>
											<td>{{conjunto.identificacion.productor}}</td>
										</tr>
										<tr ng-if="conjunto.identificacion.autores && conjunto.identificacion.autores.length > 0">
											<td>Autores</td>
											<td>
												<table class="my-table-md-dialog">
													<tr ng-repeat="autor in conjunto.identificacion.autores">
														<td>{{autor.tipo}}</td>
														<td>{{autor.nombre}}</td>
													</tr>
												</table>
											</td>
										</tr>
										<tr ng-if="conjunto.identificacion.nivelDescripcion">
											<td>Nivel de descripción</td>
											<td>{{conjunto.identificacion.nivelDescripcion}}</td>
										</tr>
										<tr ng-if="conjunto.identificacion.cantidad">
											<td>Cantidad</td>
											<td>{{conjunto.identificacion.cantidad}} unidades documentales</td>
										</tr>
										<tr ng-if="conjunto.identificacion.soporte">
											<td>Soporte</td>
											<td>{{conjunto.identificacion.soporte}}</td>
										</tr>
										<tr ng-if="conjunto.identificacion.lugar && conjunto.identificacion.lugar.length > 0">
											<td>Lugar</td>
											<td>
												<ng-map center="19.3760674,-99.1871402" zoom="15" zoom-to-include-markers="true">
													<marker ng-repeat="place in conjunto.identificacion.lugar" position="{{[place.location.lat, place.location.lng]}}"></marker>
												</ng-map>
											</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Contexto" ng-if="conjunto.contexto.historiaInstitucionalBiografica || conjunto.contexto.historiaArchivoProcedencia || (conjunto.contexto.formaIngreso && conjunto.contexto.formaIngreso.length > 0)">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.contexto.historiaInstitucionalBiografica">
											<td>Historia institucional / biográfica</td>
											<td>{{conjunto.contexto.historiaInstitucionalBiografica}}</td>
										</tr>
										<tr ng-if="conjunto.contexto.historiaArchivoProcedencia">
											<td>Historia en el archivo de procedencia</td>
											<td>{{conjunto.contexto.historiaArchivoProcedencia}}</td>
										</tr>
										<tr ng-if="conjunto.contexto.formaIngreso && conjunto.contexto.formaIngreso.length > 0">
											<td>Forma de ingreso</td>
											<td>{{conjunto.contexto.formaIngreso.join(', ')}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Estructura y contenido" ng-if="conjunto.estructuraContenido.alcanceContenido || conjunto.estructuraContenido.valoracionSeleccionEliminacion || conjunto.estructuraContenido.nuevosIngresos || conjunto.estructuraContenido.organizacion">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.estructuraContenido.alcanceContenido">
											<td>Alcance y contenido</td>
											<td>{{conjunto.estructuraContenido.alcanceContenido}}</td>
										</tr>
										<tr ng-if="conjunto.estructuraContenido.valoracionSeleccionEliminacion">
											<td>Valoracion, seleccion y eliminacion</td>
											<td>{{conjunto.estructuraContenido.valoracionSeleccionEliminacion}}</td>
										</tr>
										<tr ng-if="conjunto.estructuraContenido.nuevosIngresos">
											<td>Nuevos ingresos</td>
											<td>{{conjunto.estructuraContenido.nuevosIngresos}}</td>
										</tr>
										<tr ng-if="conjunto.estructuraContenido.organizacion">
											<td>Organización</td>
											<td>{{conjunto.estructuraContenido.organizacion}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Condiciones de acceso" ng-if="conjunto.condicionesAcceso.condicionesAcceso || conjunto.condicionesAcceso.condicionesReproduccion || conjunto.condicionesAcceso.caracteristicasFisicas || conjunto.condicionesAcceso.estadoConservacion">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.condicionesAcceso.condicionesAcceso">
											<td>Condiciones de acceso</td>
											<td>{{conjunto.condicionesAcceso.condicionesAcceso}}</td>
										</tr>
										<tr ng-if="conjunto.condicionesAcceso.condicionesReproduccion">
											<td>Condiciones de reproducción</td>
											<td>{{conjunto.condicionesAcceso.condicionesReproduccion}}</td>
										</tr>
										<tr ng-if="conjunto.condicionesAcceso.caracteristicasFisicas">
											<td>Características físicas</td>
											<td>{{conjunto.condicionesAcceso.caracteristicasFisicas}}</td>
										</tr>
										<tr ng-if="conjunto.condicionesAcceso.estadoConservacion">
											<td>Estado de conservación</td>
											<td>{{conjunto.condicionesAcceso.estadoConservacion}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Documentación asociada" ng-if="conjunto.documentacionAsociada.condicionesAcceso || conjunto.documentacionAsociada.condicionesReproduccion || conjunto.documentacionAsociada.caracteristicasFisicas || conjunto.documentacionAsociada.estadoConservacion">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.documentacionAsociada.condicionesAcceso">
											<td>Condiciones de acceso</td>
											<td>{{conjunto.documentacionAsociada.condicionesAcceso}}</td>
										</tr>
										<tr ng-if="conjunto.documentacionAsociada.condicionesReproduccion">
											<td>Condiciones de reproducción</td>
											<td>{{conjunto.documentacionAsociada.condicionesReproduccion}}</td>
										</tr>
										<tr ng-if="conjunto.documentacionAsociada.caracteristicasFisicas">
											<td>Características físicas</td>
											<td>{{conjunto.documentacionAsociada.caracteristicasFisicas}}</td>
										</tr>
										<tr ng-if="conjunto.documentacionAsociada.estadoConservacion">
											<td>Estado de conservación</td>
											<td>{{conjunto.documentacionAsociada.estadoConservacion}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Documentación asociada" ng-if="conjunto.documentacionAsociada.serieFotograficaIgualManufactura || conjunto.documentacionAsociada.registrosBase || conjunto.documentacionAsociada.reprografias || conjunto.documentacionAsociada.grabadosRelacionados">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.documentacionAsociada.serieFotograficaIgualManufactura">
											<td>Serie fotográfica de igual manufactura</td>
											<td>{{conjunto.documentacionAsociada.serieFotograficaIgualManufactura}}</td>
										</tr>
										<tr ng-if="conjunto.documentacionAsociada.registrosBase">
											<td>Registros base</td>
											<td>{{conjunto.documentacionAsociada.registrosBase}}</td>
										</tr>
										<tr ng-if="conjunto.documentacionAsociada.reprografias">
											<td>Reprografias</td>
											<td>{{conjunto.documentacionAsociada.reprografias}}</td>
										</tr>
										<tr ng-if="conjunto.documentacionAsociada.grabadosRelacionados">
											<td>Grabados relacionados</td>
											<td>{{conjunto.documentacionAsociada.grabadosRelacionados}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Publicaciones" ng-if="conjunto.publicaciones.publicacion || conjunto.publicaciones.exposicion">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.publicaciones.publicacion">
											<td>Publicación</td>
											<td>{{conjunto.publicaciones.publicacion}}</td>
										</tr>
										<tr ng-if="conjunto.publicaciones.exposicion">
											<td>Exposición</td>
											<td>{{conjunto.publicaciones.exposicion}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Notas" ng-if="conjunto.notas.notas">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<tr ng-if="conjunto.notas.notas">
											<td>Notas</td>
											<td>{{conjunto.notas.notas}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Control de la descripción" ng-if="(conjunto.controlDescripcion.documentalistas && conjunto.controlDescripcion.documentalistas.length > 0) || conjunto.controlDescripcion.reglasNormas || conjunto.createdAt || conjunto.updatedAt">
						<md-content class="md-padding">
							<md-table-container>
								<table class="my-table-md-dialog">
									<tbody>
										<!-- <tr ng-if="conjunto.controlDescripcion.documentalistas && conjunto.controlDescripcion.documentalistas.length > 0">
											<td>Documentalistas</td>
											<td>{{conjunto.controlDescripcion.documentalistas.join(', ')}}</td>
										</tr> -->
										<tr ng-if="conjunto.controlDescripcion.reglasNormas">
											<td>Reglas o normas</td>
											<td>{{conjunto.controlDescripcion.reglasNormas}}</td>
										</tr>
										<tr ng-if="conjunto.createdAt">
											<td>Fecha de creación</td>
											<td>{{conjunto.createdAt | date:'dd/MM/y HH:mm'}}</td>
										</tr>
										<tr ng-if="conjunto.updatedAt">
											<td>Fecha de última actualización</td>
											<td>{{conjunto.updatedAt | date:'dd/MM/y HH:mm'}}</td>
										</tr>
									</tbody>
								</table>
							</md-table-container>
						</md-content>
					</md-tab>
					<md-tab label="Imagen" ng-if="conjunto.adicional.imagen">
						<md-content class="md-padding">
							<img ng-src="{{'files/imagenes/' + conjunto.adicional.imagen}}" layout-fill>
						</md-content>
					</md-tab>
				</md-tabs>
			</md-dialog-content>

			<md-dialog-actions layout="row">
				<md-button class="md-icon-button" aria-label="Editar" ng-show="user && user.permisos.update" ng-click="editarConjunto()">
					<i class="material-icons">edit</i>
				</md-button>
				<md-button class="md-icon-button md-warn" ng-disabled="true" aria-label="Borrar" ng-show="user && user.permisos.delete">
					<i class="material-icons">delete</i>
				</md-button>
				<span flex></span>
				<md-button ng-click="verConjunto(conjunto.identificacion.codigoReferencia)" md-autofocus>
					Ver colección
				</md-button>
				<!-- <md-button ng-click="hide()" md-autofocus>
					Cerrar
				</md-button> -->
			</md-dialog-actions>
		</form>
	</md-dialog>
</script>
